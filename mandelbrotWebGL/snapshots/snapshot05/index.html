<html>

<head>
  <title>Mandelbrot Set in WebGL</title>

  <script src="gl-matrix.js"></script>

  <script id="shader-vs" type="x-shader/x-vertex">
      attribute vec3 aVertexPosition;

      uniform mat4 uMVMatrix;
      uniform mat4 uPMatrix;
      varying vec2 coordinates;

      void main(void) {
          gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
          coordinates = vec2(aVertexPosition.x, aVertexPosition.y);
      }
  </script>


  <script id="shader-fs" type="x-shader/x-fragment">
      precision mediump float;
      uniform float time;
      varying vec2 coordinates;


      void main(void) {
        float numIterations = 0.0;
        const float maxIterations = 100.0;

        // A complex number z = (0 + 0i)
        float zReal = 0.0;
        float zImag = 0.0;

        // A complex number c = (cReal + cImag * i)
        float cReal = coordinates.x;
        float cImag = coordinates.y;

        float zNextReal = 0.0;
        float zNextImag = 0.0;
        float dist2 = 0.0;

        for(float i = 0.0; i < maxIterations; i++)
        {
          // z^2 + c
          zNextReal = zReal * zReal - zImag * zImag + cReal;
          zNextImag = 2.0 * zReal * zImag + cImag;

          dist2 = zNextReal * zNextReal + zNextImag * zNextImag;

          zReal = zNextReal;
          zImag = zNextImag;

          numIterations++;
          if(dist2 > 1.0){
            break;
          }
        }
        if(numIterations < maxIterations){
          gl_FragColor = vec4(
            sin(numIterations + time)/2.0 + 0.5,
            coordinates.x,
            coordinates.y,
            1.0);
        }
        else{
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      }
  </script>
  <script src="requestAnimFrame.js"></script>
  <script src="script.js"> </script>

</head>

<body onload="webGLStart();" style="margin:0">
  <canvas id="canvas" style="border: none;" width="500" height="500"></canvas>
</body>
</html>
